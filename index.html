<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0">






<meta name="description" content="少敲代码，多陪家人">
<meta property="og:type" content="website">
<meta property="og:title" content="seven-cm.blog">
<meta property="og:url" content="http://seven-cm.github.io/index.html">
<meta property="og:site_name" content="seven-cm.blog">
<meta property="og:description" content="少敲代码，多陪家人">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="seven-cm.blog">
<meta name="twitter:description" content="少敲代码，多陪家人">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://seven-cm.github.io/">





  <title> seven-cm.blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?fea19912a68edcd8dd8884f7fc44c677";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">seven-cm.blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2023/04/27/如何防止docker绕过防火墙/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2023/04/27/如何防止docker绕过防火墙/" itemprop="url">
                  如何防止docker绕过防火墙
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2023-04-27T23:12:35+08:00">
                2023-04-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="先看看官方文档的说法：https-docs-docker-com-network-iptables"><a href="#先看看官方文档的说法：https-docs-docker-com-network-iptables" class="headerlink" title="先看看官方文档的说法：https://docs.docker.com/network/iptables/"></a>先看看官方文档的说法：<a href="https://docs.docker.com/network/iptables/" target="_blank" rel="noopener">https://docs.docker.com/network/iptables/</a></h3><blockquote>
<p>Docker installs two custom iptables chains named DOCKER-USER and DOCKER, and it ensures that incoming packets are always checked by these two chains first.</p>
</blockquote>
<blockquote>
<p>All of Docker’s iptables rules are added to the DOCKER chain. Do not manipulate this chain manually. If you need to add rules which load before Docker’s rules, add them to the DOCKER-USER chain. These rules are applied before any rules Docker creates automatically.</p>
</blockquote>
<h3 id="从官方描述可知，我们要防止docker绕过防火墙需要从DOCKER-USER链中入手处理"><a href="#从官方描述可知，我们要防止docker绕过防火墙需要从DOCKER-USER链中入手处理" class="headerlink" title="从官方描述可知，我们要防止docker绕过防火墙需要从DOCKER-USER链中入手处理"></a>从官方描述可知，我们要防止docker绕过防火墙需要从DOCKER-USER链中入手处理</h3><h3 id="查看docker-user规则"><a href="#查看docker-user规则" class="headerlink" title="查看docker-user规则"></a>查看docker-user规则</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -L DOCKER-<span class="keyword">USER</span> <span class="title">-n</span></span><br></pre></td></tr></table></figure>
<h3 id="删除DOCKER-USER链第一条（num）规则"><a href="#删除DOCKER-USER链第一条（num）规则" class="headerlink" title="删除DOCKER-USER链第一条（num）规则"></a>删除DOCKER-USER链第一条（num）规则</h3><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -D DOCKER-<span class="keyword">USER</span> <span class="title">1</span></span><br></pre></td></tr></table></figure>
<h3 id="DOCKER-USER原始规则"><a href="#DOCKER-USER原始规则" class="headerlink" title="DOCKER-USER原始规则"></a>DOCKER-USER原始规则</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -I DOCKER-USER -s <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">0</span> -j RETURN</span><br></pre></td></tr></table></figure>
<h3 id="example1-禁止非192-168-0-0-16网段访问docker的特定端口-2181-3306-6379"><a href="#example1-禁止非192-168-0-0-16网段访问docker的特定端口-2181-3306-6379" class="headerlink" title="example1 禁止非192.168.0.0/16网段访问docker的特定端口(2181 3306 6379)"></a>example1 禁止非192.168.0.0/16网段访问docker的特定端口(2181 3306 6379)</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 端口是指docker内部的端口 而非宿主机的端口</span><br><span class="line">iptables -I DOCKER-USER -i em1 -p tcp -m multiport --dport <span class="number">2181</span>,<span class="number">3306</span>,<span class="number">6379</span> ! -s <span class="number">192.168</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">16</span> -j DROP</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2021/04/10/记一次数据库100-优化过程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2021/04/10/记一次数据库100-优化过程/" itemprop="url">
                  记一次数据库100%优化过程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-10T23:43:51+08:00">
                2021-04-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">宿主机：CentOS Linux release <span class="number">7.6</span><span class="number">.1810</span> (Core)</span><br><span class="line">docker版本：Docker version <span class="number">19.03</span><span class="number">.12</span>, build <span class="number">48</span>a66213fe</span><br><span class="line">mysql镜像版本：mysql:<span class="number">5.7</span><span class="number">.31</span></span><br></pre></td></tr></table></figure>
<h1 id="问题表现"><a href="#问题表现" class="headerlink" title="问题表现"></a>问题表现</h1><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker stats</span><br><span class="line"></span><br><span class="line">CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT     MEM %               NET I/O             BLOCK I/O           PIDS</span><br><span class="line"><span class="number">3f</span>7fb4fc6bb9        mysql               <span class="number">219.60</span>%             <span class="number">897.3</span>MiB / <span class="number">15.51</span>GiB   <span class="number">5.65</span>%               <span class="number">2.15</span>TB / <span class="number">18.4</span>TB     <span class="number">0</span>B / <span class="number">0</span>B             <span class="number">139</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>会发现 mysql 经常处于 cpu% &gt; 150 的情况</p>
</blockquote>
<h2 id="解决流程"><a href="#解决流程" class="headerlink" title="解决流程"></a>解决流程</h2><h3 id="优先查看-slow-log"><a href="#优先查看-slow-log" class="headerlink" title="优先查看 slow.log"></a>优先查看 slow.log</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f <span class="regexp">/xxx/</span>xxx<span class="regexp">/xx/</span>slow.log</span><br></pre></td></tr></table></figure>
<p>10 几分钟过后，却没有任何新的慢查询语句输出。</p>
<h3 id="进数据库"><a href="#进数据库" class="headerlink" title="进数据库"></a>进数据库</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -h127<span class="number">.0</span><span class="number">.0</span><span class="number">.1</span> -p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">show processlist;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>通过 show processlist 查看数据库正在执行的语句。</p>
</blockquote>
<p>把相关执行语句 explain 观察一下查询效率问题。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">explain</span> <span class="keyword">select</span> xxxxx <span class="keyword">from</span> xxxxx;</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">mysql&gt;</span> <span class="string">explain</span> <span class="string">select</span> <span class="string">*</span> <span class="string">from</span>  <span class="string">xxxx</span>  <span class="string">WHERE</span> <span class="string">a=41</span> <span class="string">AND</span> <span class="string">b=1</span>  <span class="string">order</span> <span class="string">by</span> <span class="string">id</span> <span class="string">desc</span> <span class="string">limit</span> <span class="number">1</span> <span class="string">\G;</span></span><br><span class="line"><span class="string">***************************</span> <span class="number">1</span><span class="string">.</span> <span class="string">row</span> <span class="string">***************************</span></span><br><span class="line">           <span class="attr">id:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">select_type:</span> <span class="string">SIMPLE</span></span><br><span class="line">        <span class="attr">table:</span> <span class="string">xxxx</span></span><br><span class="line">   <span class="attr">partitions:</span> <span class="literal">NULL</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">range</span></span><br><span class="line"><span class="attr">possible_keys:</span> <span class="string">xxxx_a,xxxx_id</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">xxxx_b</span></span><br><span class="line">      <span class="attr">key_len:</span> <span class="number">2</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="literal">NULL</span></span><br><span class="line">         <span class="attr">rows:</span> <span class="number">368928</span></span><br><span class="line">     <span class="attr">filtered:</span> <span class="number">3.49</span></span><br><span class="line">        <span class="attr">Extra:</span> <span class="string">Using</span> <span class="string">index</span> <span class="string">condition;</span> <span class="string">Using</span> <span class="string">where</span></span><br><span class="line"><span class="number">1</span> <span class="string">row</span> <span class="string">in</span> <span class="string">set,</span> <span class="number">1</span> <span class="string">warning</span> <span class="string">(0.00</span> <span class="string">sec)</span></span><br></pre></td></tr></table></figure>
<p>可见每次查询类似的结果，可能搜索 30W 的数据(估算值);</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">mysql&gt;</span> <span class="string">explain</span> <span class="string">select</span> <span class="string">*</span> <span class="string">from</span> <span class="string">xxxx</span> <span class="string">join</span> <span class="string">(select</span> <span class="string">max(id)</span> <span class="string">id</span> <span class="string">from</span> <span class="string">xxxx</span>  <span class="string">WHERE</span>  <span class="string">a=41</span> <span class="string">AND</span> <span class="string">b=1)</span> <span class="string">as</span> <span class="string">t</span> <span class="string">on</span> <span class="string">t.id</span> <span class="string">=</span> <span class="string">xxxx.id</span> <span class="string">\G;</span></span><br><span class="line"><span class="string">***************************</span> <span class="number">1</span><span class="string">.</span> <span class="string">row</span> <span class="string">***************************</span></span><br><span class="line">           <span class="attr">id:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">select_type:</span> <span class="string">PRIMARY</span></span><br><span class="line">        <span class="attr">table:</span> <span class="string">&lt;derived2&gt;</span></span><br><span class="line">   <span class="attr">partitions:</span> <span class="literal">NULL</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">system</span></span><br><span class="line"><span class="attr">possible_keys:</span> <span class="literal">NULL</span></span><br><span class="line">          <span class="attr">key:</span> <span class="literal">NULL</span></span><br><span class="line">      <span class="attr">key_len:</span> <span class="literal">NULL</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="literal">NULL</span></span><br><span class="line">         <span class="attr">rows:</span> <span class="number">1</span></span><br><span class="line">     <span class="attr">filtered:</span> <span class="number">100.00</span></span><br><span class="line">        <span class="attr">Extra:</span> <span class="literal">NULL</span></span><br><span class="line"><span class="string">***************************</span> <span class="number">2</span><span class="string">.</span> <span class="string">row</span> <span class="string">***************************</span></span><br><span class="line">           <span class="attr">id:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">select_type:</span> <span class="string">PRIMARY</span></span><br><span class="line">        <span class="attr">table:</span> <span class="string">xxxx</span></span><br><span class="line">   <span class="attr">partitions:</span> <span class="literal">NULL</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">const</span></span><br><span class="line"><span class="attr">possible_keys:</span> <span class="string">PRIMARY</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">PRIMARY</span></span><br><span class="line">      <span class="attr">key_len:</span> <span class="number">4</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="string">const</span></span><br><span class="line">         <span class="attr">rows:</span> <span class="number">1</span></span><br><span class="line">     <span class="attr">filtered:</span> <span class="number">100.00</span></span><br><span class="line">        <span class="attr">Extra:</span> <span class="literal">NULL</span></span><br><span class="line"><span class="string">***************************</span> <span class="number">3</span><span class="string">.</span> <span class="string">row</span> <span class="string">***************************</span></span><br><span class="line">           <span class="attr">id:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">select_type:</span> <span class="string">DERIVED</span></span><br><span class="line">        <span class="attr">table:</span> <span class="string">xxxx</span></span><br><span class="line">   <span class="attr">partitions:</span> <span class="literal">NULL</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">index_merge</span></span><br><span class="line"><span class="attr">possible_keys:</span> <span class="string">xxxx_a,xxxx_id</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">xxxx_b</span></span><br><span class="line">      <span class="attr">key_len:</span> <span class="number">5</span><span class="string">,2</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="literal">NULL</span></span><br><span class="line">         <span class="attr">rows:</span> <span class="number">12894</span></span><br><span class="line">     <span class="attr">filtered:</span> <span class="number">100.00</span></span><br><span class="line">        <span class="attr">Extra:</span> <span class="string">Using</span> <span class="string">intersect(xxx_id,xxx_b);</span> <span class="string">Using</span> <span class="string">where;</span> <span class="string">Using</span> <span class="string">index</span></span><br><span class="line"><span class="number">3</span> <span class="string">rows</span> <span class="string">in</span> <span class="string">set,</span> <span class="number">1</span> <span class="string">warning</span> <span class="string">(0.06</span> <span class="string">sec)</span></span><br></pre></td></tr></table></figure>
<p>优化后的 docker stats</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT     MEM %               NET I/O             BLOCK I/O           PIDS</span><br><span class="line"><span class="number">3f</span>7fb4fc6bb9        mysql               <span class="number">21.46</span>%              <span class="number">897.3</span>MiB / <span class="number">15.51</span>GiB   <span class="number">5.65</span>%               <span class="number">2.15</span>TB / <span class="number">18.4</span>TB     <span class="number">0</span>B / <span class="number">0</span>B             <span class="number">139</span></span><br></pre></td></tr></table></figure>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><p>1、<a href="https://dev.mysql.com/doc/refman/5.7/en/explain-output.html" target="_blank" rel="noopener">mysql 5.7 有关 explain 输出的解析</a></p>
<p>2、<a href="https://www.eversql.com/mysql-explain-example-explaining-mysql-explain-using-stackoverflow-data/#:~:text=rows%20-%20Indicates%20the%20amount%20of%20number%20of,unfiltered%20by%20the%20conditions%20in%20the%20WHERE%20clause." target="_blank" rel="noopener">MySQL Explain Example</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2021/04/10/记一次svn迁移/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2021/04/10/记一次svn迁移/" itemprop="url">
                  记一次svn迁移
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-10T23:42:49+08:00">
                2021-04-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>准备把 svn 迁移到 gitlab 去;故记录一下操作过程。</p>
</blockquote>
<h1 id="迁移命令"><a href="#迁移命令" class="headerlink" title="迁移命令"></a>迁移命令</h1><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git svn <span class="keyword">clone</span> <span class="title">svn</span>://xxx/xxx/xxx</span><br></pre></td></tr></table></figure>
<p>奈何在 windows 下执行实在太慢了。3000 多个的提交记录，执行了 2 个小时还未完成。</p>
<p>通过搜索得知 在 linux 中执行速度比在 Windows 中快。</p>
<blockquote>
<p>This seems to be a problem of the windows port of ‘git svn’. Or more specifically one of the perl libraries of ‘git svn’ on windows/cygwin.</p>
</blockquote>
<h1 id="在虚拟机中安装-CentOS-7"><a href="#在虚拟机中安装-CentOS-7" class="headerlink" title="在虚拟机中安装 CentOS 7"></a>在虚拟机中安装 CentOS 7</h1><h1 id="安装-git-svn"><a href="#安装-git-svn" class="headerlink" title="安装 git-svn"></a>安装 git-svn</h1><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> git-svn</span><br></pre></td></tr></table></figure>
<h1 id="再次执行迁移命令"><a href="#再次执行迁移命令" class="headerlink" title="再次执行迁移命令"></a>再次执行迁移命令</h1><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git svn <span class="keyword">clone</span> <span class="title">svn</span>://xxx/xxx/xxx</span><br></pre></td></tr></table></figure>
<p>最终花几分钟执行完成。</p>
<h1 id="后续提交到-git"><a href="#后续提交到-git" class="headerlink" title="后续提交到 git"></a>后续提交到 git</h1><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git remote <span class="keyword">add</span><span class="bash"> origin https://xxx.xxx.xxx.git</span></span><br><span class="line">git <span class="keyword">add</span><span class="bash"> .</span></span><br><span class="line">git commit -m <span class="string">"svn update 2 git"</span></span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2020/08/23/阿里云RDS到期切换记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/08/23/阿里云RDS到期切换记录/" itemprop="url">
                  阿里云RDS到期切换记录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-23T22:43:48+08:00">
                2020-08-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>因阿里云RDS快到期了；而因业务线的调整，我们打算不再继续对RDS续费，故需对线上的RDS进行一次数据库转移。</p>
<h2 id="转移方法"><a href="#转移方法" class="headerlink" title="转移方法"></a>转移方法</h2><p>为了方便快捷地转换，我们是在ECS建立数据库，然后对RDS进行主从同步。</p>
<h3 id="数据库版本"><a href="#数据库版本" class="headerlink" title="数据库版本"></a>数据库版本</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 阿里云RDS</span></span><br><span class="line"><span class="attr">MySQL</span> <span class="string">5.6</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ECS </span></span><br><span class="line"><span class="attr">MySQL</span> <span class="string">5.7</span></span><br></pre></td></tr></table></figure>
<h3 id="从库my-cnf配置"><a href="#从库my-cnf配置" class="headerlink" title="从库my.cnf配置"></a>从库my.cnf配置</h3><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line"><span class="attr">port</span>            = <span class="number">3306</span></span><br><span class="line"><span class="attr">socket</span>          = /tmp/mysql.sock</span><br><span class="line"><span class="attr">default-character-set=utf8mb4</span></span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="attr">server-id</span>       = <span class="number">100</span></span><br><span class="line"><span class="attr">port</span>            = <span class="number">3306</span></span><br><span class="line"><span class="attr">user</span>            = mysql</span><br><span class="line"><span class="attr">socket</span>          = /tmp/mysql.sock</span><br><span class="line"><span class="attr">datadir</span>         = /data/mysql/data</span><br><span class="line"><span class="attr">character_set_server=utf8mb4</span></span><br><span class="line"><span class="attr">default-storage-engine</span> = InnoDB</span><br><span class="line"></span><br><span class="line"><span class="attr">back_log</span> = <span class="number">50</span></span><br><span class="line"><span class="attr">max_connections</span> = <span class="number">1000</span></span><br><span class="line"><span class="attr">max_connect_errors</span> = <span class="number">6000</span></span><br><span class="line"><span class="attr">open_files_limit</span> = <span class="number">65535</span></span><br><span class="line"><span class="attr">table_open_cache</span> = <span class="number">128</span></span><br><span class="line"><span class="attr">max_allowed_packet</span> = <span class="number">4</span>M</span><br><span class="line"><span class="attr">binlog_cache_size</span> = <span class="number">1</span>M</span><br><span class="line"><span class="attr">max_heap_table_size</span> = <span class="number">8</span>M</span><br><span class="line"><span class="attr">tmp_table_size</span> = <span class="number">16</span>M</span><br><span class="line"><span class="attr">read_buffer_size</span> = <span class="number">2</span>M</span><br><span class="line"><span class="attr">read_rnd_buffer_size</span> = <span class="number">8</span>M</span><br><span class="line"><span class="attr">sort_buffer_size</span> = <span class="number">8</span>M</span><br><span class="line"><span class="attr">join_buffer_size</span> = <span class="number">8</span>M</span><br><span class="line"><span class="attr">thread_cache_size</span> = <span class="number">8</span></span><br><span class="line"><span class="attr">query_cache_size</span> = <span class="number">0</span></span><br><span class="line"><span class="attr">query_cache_limit</span> = <span class="number">2</span>M</span><br><span class="line"><span class="attr">key_buffer_size</span> = <span class="number">16</span>M</span><br><span class="line"><span class="attr">transaction_isolation</span> = READ-COMMITTED</span><br><span class="line"><span class="attr">log_bin</span> = /data/mysql/log/binlog/mysql-bin</span><br><span class="line"><span class="attr">binlog_format</span> = ROW</span><br><span class="line"><span class="attr">log-error=</span> /data/mysql/log/log/error.log</span><br><span class="line"><span class="attr">slow_query_log</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">long_query_time</span> = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="attr">slow_query_log_file</span> = /data/mysql/log/log/slow.log</span><br><span class="line"><span class="attr">innodb_buffer_pool_size</span> = <span class="number">128</span>M</span><br><span class="line"><span class="attr">innodb_write_io_threads</span> = <span class="number">4</span></span><br><span class="line"><span class="attr">innodb_read_io_threads</span> = <span class="number">4</span></span><br><span class="line"><span class="comment"># 5.7.2版本已经过时</span></span><br><span class="line"><span class="attr">innodb_thread_concurrency</span> = <span class="number">0</span></span><br><span class="line"><span class="attr">innodb_flush_log_at_trx_commit</span> = <span class="number">2</span></span><br><span class="line"><span class="attr">innodb_purge_threads</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">innodb_log_buffer_size</span> = <span class="number">2</span>M</span><br><span class="line"><span class="attr">innodb_log_file_size</span> = <span class="number">256</span>M</span><br><span class="line"><span class="attr">innodb_log_files_in_group</span> = <span class="number">3</span></span><br><span class="line"><span class="attr">innodb_max_dirty_pages_pct</span> = <span class="number">90</span></span><br><span class="line"><span class="attr">innodb_lock_wait_timeout</span> = <span class="number">120</span></span><br><span class="line"><span class="attr">bulk_insert_buffer_size</span> = <span class="number">8</span>M</span><br><span class="line"><span class="attr">myisam_sort_buffer_size</span> = <span class="number">8</span>M</span><br><span class="line"><span class="attr">innodb_file_per_table</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">innodb_data_file_path</span> = ibdata0:<span class="number">2</span>G;ibdata1:<span class="number">2</span>G;</span><br><span class="line"><span class="attr">innodb_data_home_dir</span> = /data/mysql/data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">gtid_mode=on</span></span><br><span class="line"><span class="attr">enforce_gtid_consistency=on</span></span><br><span class="line"><span class="attr">log-slave-updates=1</span></span><br><span class="line"><span class="comment">#配置</span></span><br><span class="line"><span class="attr">replicate-do-db</span>         =  aaa</span><br><span class="line"><span class="attr">replicate-ignore-db</span>     =  mysql</span><br><span class="line"><span class="attr">replicate-ignore-db</span>     =  information_schema</span><br><span class="line"><span class="attr">replicate-ignore-db</span>     =  performance_schema</span><br><span class="line"><span class="attr">replicate-ignore-db</span>     =  bbb</span><br><span class="line"><span class="comment">#replicate-wild-ignore-table     = mysql.% //不需要同步的表（可选）</span></span><br><span class="line"><span class="comment">#replicate-wild-ignore-table     = test.% //不需要同步的表（可选）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[mysqldump]</span><br><span class="line">quick</span><br><span class="line"><span class="attr">max_allowed_packet</span> = <span class="number">16</span>M</span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line"><span class="attr">open-files-limit</span> = <span class="number">8192</span></span><br></pre></td></tr></table></figure>
<h3 id="导出RDS上的数据"><a href="#导出RDS上的数据" class="headerlink" title="导出RDS上的数据"></a>导出RDS上的数据</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -usuper_db -p <span class="attribute">--set-gtid-purged</span>=OFF -hrm-xxx.mysql.rds.aliyuncs.com <span class="attribute">--ignore-table</span>=xxx.aaa <span class="attribute">--ignore-table</span>=xxx.bbb --single-transaction <span class="attribute">--master-data</span>=2 xxx | gzip &gt; ./xxx_0800.sql.gz</span><br></pre></td></tr></table></figure>
<blockquote>
<p>因某个数据表的数据量太大了，故直接忽略该不重要的数据；注意语句中需使用–master-data=2获得导出数据时的POS信息：</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-- CHANGE MASTER <span class="keyword">TO</span> <span class="attribute">MASTER_LOG_FILE</span>=<span class="string">'mysql-bin.000009'</span>, <span class="attribute">MASTER_LOG_POS</span>=185396519;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用–master-data的时候需使用RDS的超级用户权限</p>
</blockquote>
<h3 id="ECS中对mysql导入数据"><a href="#ECS中对mysql导入数据" class="headerlink" title="ECS中对mysql导入数据"></a>ECS中对mysql导入数据</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">source</span> <span class="regexp">/xxx/</span>xxx<span class="regexp">/xxx.sql</span></span><br></pre></td></tr></table></figure>
<h3 id="ECS开始主从同步"><a href="#ECS开始主从同步" class="headerlink" title="ECS开始主从同步"></a>ECS开始主从同步</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">change</span> <span class="keyword">master</span> <span class="keyword">to</span> master_host=<span class="string">'rm-xxx.mysql.rds.aliyuncs.com'</span>,master_port=<span class="number">3306</span>,master_user=<span class="string">'xxx'</span>,master_password=<span class="string">'xxxxx'</span>,master_log_file=<span class="string">'mysql-bin.000009'</span>,master_log_pos=<span class="number">185396519</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始同步</span></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">slave</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看同步状态</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">slave</span> <span class="keyword">status</span> \G;</span><br></pre></td></tr></table></figure>
<h3 id="可能遇到的问题"><a href="#可能遇到的问题" class="headerlink" title="可能遇到的问题"></a>可能遇到的问题</h3><blockquote>
<p>Last_Error: The incident LOST_EVENTS occured on the master. Message: REVOKE/GRANT failed while granting/revoking privileges in databases.</p>
</blockquote>
<p>原因：在对主库作grant的时候，因为出错，导致从库同步失败。</p>
<h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h4><p>先查看同步的信息<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">show</span> <span class="string">slave</span> <span class="string">status</span> <span class="string">\G;</span></span><br><span class="line"><span class="string">***************************</span> <span class="number">1</span><span class="string">.</span> <span class="string">row</span> <span class="string">***************************</span></span><br><span class="line">               <span class="attr">Slave_IO_State:</span> <span class="string">Waiting</span> <span class="string">for</span> <span class="string">master</span> <span class="string">to</span> <span class="string">send</span> <span class="string">event</span></span><br><span class="line">                  <span class="attr">Master_Host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">                  <span class="attr">Master_User:</span> <span class="string">replica</span></span><br><span class="line">                  <span class="attr">Master_Port:</span> <span class="number">3306</span></span><br><span class="line">                <span class="attr">Connect_Retry:</span> <span class="number">60</span></span><br><span class="line">              <span class="attr">Master_Log_File:</span> <span class="string">mysql-bin.000010</span></span><br><span class="line">          <span class="attr">Read_Master_Log_Pos:</span> <span class="number">89679008</span></span><br><span class="line">               <span class="attr">Relay_Log_File:</span> <span class="string">test-relay-bin.000002</span></span><br><span class="line">                <span class="attr">Relay_Log_Pos:</span> <span class="number">96157454</span></span><br><span class="line">        <span class="attr">Relay_Master_Log_File:</span> <span class="string">mysql-bin.000009</span></span><br><span class="line">             <span class="attr">Slave_IO_Running:</span> <span class="literal">Yes</span></span><br><span class="line">            <span class="attr">Slave_SQL_Running:</span> <span class="literal">No</span></span><br><span class="line">              <span class="attr">Replicate_Do_DB:</span> <span class="string">aaa</span></span><br><span class="line">          <span class="attr">Replicate_Ignore_DB:</span> <span class="string">mysql,information_schema,performance_schema</span></span><br><span class="line">           <span class="attr">Replicate_Do_Table:</span> </span><br><span class="line">       <span class="attr">Replicate_Ignore_Table:</span> </span><br><span class="line">      <span class="attr">Replicate_Wild_Do_Table:</span> </span><br><span class="line">  <span class="attr">Replicate_Wild_Ignore_Table:</span> <span class="string">aaa.test1,aaa.test2</span></span><br><span class="line">                   <span class="attr">Last_Errno:</span> <span class="number">1590</span></span><br><span class="line">                   <span class="attr">Last_Error: The incident LOST_EVENTS occured on the master. Message:</span> <span class="string">REVOKE/GRANT</span> <span class="string">failed</span> <span class="string">while</span> <span class="string">granting/revoking</span> <span class="string">privileges</span> <span class="string">in</span> <span class="string">databases.</span></span><br><span class="line">                 <span class="attr">Skip_Counter:</span> <span class="number">0</span></span><br><span class="line">          <span class="attr">Exec_Master_Log_Pos:</span> <span class="number">281553653</span></span><br><span class="line">              <span class="attr">Relay_Log_Space:</span> <span class="number">185837413</span></span><br><span class="line">              <span class="attr">Until_Condition:</span> <span class="string">None</span></span><br><span class="line">               <span class="attr">Until_Log_File:</span> </span><br><span class="line">                <span class="attr">Until_Log_Pos:</span> <span class="number">0</span></span><br><span class="line">           <span class="attr">Master_SSL_Allowed:</span> <span class="literal">No</span></span><br><span class="line">           <span class="attr">Master_SSL_CA_File:</span> </span><br><span class="line">           <span class="attr">Master_SSL_CA_Path:</span> </span><br><span class="line">              <span class="attr">Master_SSL_Cert:</span> </span><br><span class="line">            <span class="attr">Master_SSL_Cipher:</span> </span><br><span class="line">               <span class="attr">Master_SSL_Key:</span> </span><br><span class="line">        <span class="attr">Seconds_Behind_Master:</span> <span class="literal">NULL</span></span><br><span class="line"><span class="attr">Master_SSL_Verify_Server_Cert:</span> <span class="literal">No</span></span><br><span class="line">                <span class="attr">Last_IO_Errno:</span> <span class="number">0</span></span><br><span class="line">                <span class="attr">Last_IO_Error:</span> </span><br><span class="line">               <span class="attr">Last_SQL_Errno:</span> <span class="number">1590</span></span><br><span class="line">               <span class="attr">Last_SQL_Error: The incident LOST_EVENTS occured on the master. Message:</span> <span class="string">REVOKE/GRANT</span> <span class="string">failed</span> <span class="string">while</span> <span class="string">granting/revoking</span> <span class="string">privileges</span> <span class="string">in</span> <span class="string">databases.</span></span><br><span class="line">  <span class="attr">Replicate_Ignore_Server_Ids:</span> </span><br><span class="line">             <span class="attr">Master_Server_Id:</span> <span class="number">101</span></span><br><span class="line">                  <span class="attr">Master_UUID:</span> <span class="string">0ca4a659-d53a-11ea-b6e9-00163e0c6331</span></span><br><span class="line">             <span class="attr">Master_Info_File:</span> <span class="string">/var/lib/mysql/master.info</span></span><br><span class="line">                    <span class="attr">SQL_Delay:</span> <span class="number">0</span></span><br><span class="line">          <span class="attr">SQL_Remaining_Delay:</span> <span class="literal">NULL</span></span><br><span class="line">      <span class="attr">Slave_SQL_Running_State:</span> </span><br><span class="line">           <span class="attr">Master_Retry_Count:</span> <span class="number">86400</span></span><br><span class="line">                  <span class="attr">Master_Bind:</span> </span><br><span class="line">      <span class="attr">Last_IO_Error_Timestamp:</span> </span><br><span class="line">     <span class="attr">Last_SQL_Error_Timestamp:</span> <span class="number">200822</span> <span class="number">11</span><span class="string">:55:36</span></span><br><span class="line">               <span class="attr">Master_SSL_Crl:</span> </span><br><span class="line">           <span class="attr">Master_SSL_Crlpath:</span> </span><br><span class="line">           <span class="attr">Retrieved_Gtid_Set:</span> <span class="string">0ca4a659-d53a-11ea-b6e9-00163e0c6331:14478471-14877986</span></span><br><span class="line">            <span class="attr">Executed_Gtid_Set:</span> <span class="string">0ca4a659-d53a-11ea-b6e9-00163e0c6331:14478471-14688606,</span></span><br><span class="line"><span class="string">11cb8e59-e41e-11ea-b249-0242ac130002:1-4042</span></span><br><span class="line">                <span class="attr">Auto_Position:</span> <span class="number">0</span></span><br><span class="line">         <span class="attr">Replicate_Rewrite_DB:</span> </span><br><span class="line">                 <span class="attr">Channel_Name:</span> </span><br><span class="line">           <span class="attr">Master_TLS_Version:</span> </span><br><span class="line"><span class="number">1</span> <span class="string">row</span> <span class="string">in</span> <span class="string">set</span> <span class="string">(0.00</span> <span class="string">sec)</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>注意 Exec_Master_Log_Pos: 281553653 说明我们已经执行到 281553653 之后出现了问题。</p>
</blockquote>
<h4 id="查看binlog信息"><a href="#查看binlog信息" class="headerlink" title="查看binlog信息"></a>查看binlog信息</h4><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog --no-defaults mysql-bin<span class="number">.000009</span> |tail <span class="number">-40</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># at <span class="number">281553622</span></span><br><span class="line">#<span class="number">200822</span> <span class="number">11</span>:<span class="number">38</span>:<span class="number">18</span> server id <span class="number">101</span>  end_log_pos <span class="number">281553653</span> CRC32 <span class="number">0x6abd8fc2</span>  Xid = <span class="number">266891639</span></span><br><span class="line">COMMIT<span class="comment">/*!*/</span>;</span><br><span class="line"># at <span class="number">281553653</span></span><br><span class="line">#<span class="number">200822</span> <span class="number">11</span>:<span class="number">38</span>:<span class="number">18</span> server id <span class="number">101</span>  end_log_pos <span class="number">281553718</span> CRC32 <span class="number">0xe3dcaa94</span>  GTID [commit=yes]</span><br><span class="line">SET @@SESSION.GTID_NEXT= <span class="string">'0ca4a659-d53a-11ea-b6e9-00163e0c6331:14688607'</span><span class="comment">/*!*/</span>;</span><br><span class="line"># at <span class="number">281553718</span></span><br><span class="line">#<span class="number">200822</span> <span class="number">11</span>:<span class="number">38</span>:<span class="number">18</span> server id <span class="number">101</span>  end_log_pos <span class="number">281553816</span> CRC32 <span class="number">0xa0997e79</span> </span><br><span class="line"># Incident: LOST_EVENTS</span><br><span class="line">RELOAD DATABASE; # Shall generate syntax error</span><br><span class="line"># at <span class="number">281553816</span></span><br><span class="line">#<span class="number">200822</span> <span class="number">11</span>:<span class="number">38</span>:<span class="number">18</span> server id <span class="number">101</span>  end_log_pos <span class="number">281553863</span> CRC32 <span class="number">0x3b237165</span>  Rotate to mysql-bin<span class="number">.000010</span>  pos: <span class="number">4</span></span><br><span class="line">DELIMITER ;</span><br><span class="line"># End of log file</span><br><span class="line">ROLLBACK <span class="comment">/* added by mysqlbinlog */</span>;</span><br><span class="line"><span class="comment">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/</span>;</span><br><span class="line"><span class="comment">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/</span>;</span><br></pre></td></tr></table></figure>
<p>可了解到出现错误后，主库重新开启了一个新的binlog日志；起始的pos为：4<br><code>#200822 11:38:18 server id 101  end_log_pos 281553863 CRC32 0x3b237165  Rotate to mysql-bin.000010  pos: 4</code></p>
<p>恢复同步<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">stop</span> <span class="keyword">slave</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">change</span> <span class="keyword">master</span> <span class="keyword">to</span> master_host=<span class="string">'rm-xxx.mysql.rds.aliyuncs.com'</span>,master_port=<span class="number">3306</span>,master_user=<span class="string">'xxx'</span>,master_password=<span class="string">'xxxxx'</span>,master_log_file=<span class="string">'mysql-bin.000010'</span>,master_log_pos=<span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">slave</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">slave</span> <span class="keyword">status</span> \G;</span><br></pre></td></tr></table></figure></p>
<h4 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h4><p>如果不习惯使用mysqlbinlog命令，可以直接在数据库中执行<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">binlog</span> <span class="keyword">events</span> <span class="keyword">in</span> <span class="string">'mysql-bin.000009'</span> <span class="keyword">from</span> <span class="number">185396519</span> <span class="keyword">limit</span> <span class="number">30</span>;</span><br></pre></td></tr></table></figure></p>
<p>可查看binlog的相关信息。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2020/08/23/gitalk-Validation-Failed-问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/08/23/gitalk-Validation-Failed-问题/" itemprop="url">
                  gitalk Validation Failed 问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-23T22:39:25+08:00">
                2020-08-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>在按网上的教程搭建好gitalk后，出现“gitalk Validation Failed”的问题。</p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>【csdn-death05】·gitalk Error: Validation Failed·<a href="https://blog.csdn.net/death05/article/details/83618887" target="_blank" rel="noopener">https://blog.csdn.net/death05/article/details/83618887</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2020/08/23/Host-key-verification-failed-问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/08/23/Host-key-verification-failed-问题/" itemprop="url">
                  Host key verification failed 问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-08-23T22:34:46+08:00">
                2020-08-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>今天在 win 10 做 hexo d 的时候，提示”Host key verification failed”。</p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ssh</span> -T git<span class="variable">@github</span>.com</span><br></pre></td></tr></table></figure>
<blockquote>
<p>回车后，输入yes</p>
</blockquote>
<p>参考来源：</p>
<p>【知乎】<a href="https://zhuanlan.zhihu.com/p/113420658?from_voters_page=true" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/113420658?from_voters_page=true</a></p>
<p>【stackoverflow】<a href="https://stackoverflow.com/questions/13363553/git-error-host-key-verification-failed-when-connecting-to-remote-repository/29908140#29908140" target="_blank" rel="noopener">https://stackoverflow.com/questions/13363553/git-error-host-key-verification-failed-when-connecting-to-remote-repository/29908140#29908140</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2019/10/27/记smart-socket在生产环境使用遇到的一些问题以及解决思路/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/10/27/记smart-socket在生产环境使用遇到的一些问题以及解决思路/" itemprop="url">
                  记smart-socket在生产环境使用遇到的一些问题以及解决思路
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-27T18:48:04+08:00">
                2019-10-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近需要做一些串口通讯协议；而用户量也不是很大，故直接使用<a href="https://gitee.com/smartboot/smart-socket/" target="_blank" rel="noopener">smart-socket</a>作为通讯的载体。</p>
<blockquote>
<p>smart-socket的使用，可按作者给出的文档即可。此处不再作介绍。</p>
</blockquote>
<h2 id="问题1-对session并发写入的时候，会出现数据错乱。"><a href="#问题1-对session并发写入的时候，会出现数据错乱。" class="headerlink" title="问题1 - 对session并发写入的时候，会出现数据错乱。"></a>问题1 - 对session并发写入的时候，会出现数据错乱。</h2><p>问题定位：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">writeBuffer.writeInt(bytes.length);</span><br><span class="line">writeBuffer.write(bytes);</span><br></pre></td></tr></table></figure></p>
<p>原因是在write的时候，分两个写，会引发并发问题；解决方法：应将所有数据都写到一个buffer中，然后再write。</p>
<h2 id="问题2-发现接收到到数据错乱。"><a href="#问题2-发现接收到到数据错乱。" class="headerlink" title="问题2 - 发现接收到到数据错乱。"></a>问题2 - 发现接收到到数据错乱。</h2><p>一开始，是按串口文档的协议作定长数据处理；测试的时候并没有什么问题。然而发布到线上，却会每隔几个小时就会出现数据乱。协议的decode代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] decode(ByteBuffer readBuffer, AioSession&lt;<span class="keyword">byte</span>[]&gt; aioSession) &#123;</span><br><span class="line">    <span class="keyword">byte</span> lengthByte = readBuffer.get(<span class="number">1</span>);<span class="comment">//获取消息数据长度信息</span></span><br><span class="line">    String lengthHex = HexUtils.byteToHex(lengthByte);</span><br><span class="line">    <span class="keyword">int</span> length = Integer.parseInt(lengthHex, <span class="number">16</span>) + <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span>(readBuffer.remaining() &lt; length) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">byte</span>[] data = <span class="keyword">new</span> <span class="keyword">byte</span>[length];</span><br><span class="line">    readBuffer.get(data);</span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过日志打印，发现控制板返回并不是一条一条地发，而是会把多条协议的结果合并一起发回来。如果一条协议去读取数据，就会有数据没有读完，引起后面的数据错乱。<br>因协议的消息是一类消息，故直接把所有数据读出来，后面再根据协议分割数据，再处理即可。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class ByteArrayNewProtocol implements Protocol&lt;byte[]&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] decode(ByteBuffer readBuffer, AioSession&lt;<span class="keyword">byte</span>[]&gt; aioSession) &#123;</span><br><span class="line">        <span class="keyword">if</span> (readBuffer.remaining() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] data = <span class="keyword">new</span> <span class="keyword">byte</span>[readBuffer.remaining()];</span><br><span class="line">            readBuffer.get(data);</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2019/10/26/构建内网https证书/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/10/26/构建内网https证书/" itemprop="url">
                  构建内网https证书
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-10-26T21:08:45+08:00">
                2019-10-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>今天刚用新 MacBook Pro 打包 iOS 应用；而公司又没有扩展坞；本想通过 WI-FI 调试，但是需先用数据线链接到电脑；只好用 OTA 方式安装。</p>
<h2 id="搭建-OTA-过程"><a href="#搭建-OTA-过程" class="headerlink" title="搭建 OTA 过程"></a>搭建 OTA 过程</h2><h3 id="生成内网-IP-https-证书"><a href="#生成内网-IP-https-证书" class="headerlink" title="生成内网 IP https 证书"></a>生成内网 IP https 证书</h3><p>具体操作，参考 王王王勇旭 的<a href="https://blog.csdn.net/Newpyer/article/details/79450128" target="_blank" rel="noopener">解决自签名证书在 Chrome 上的“不是私密连接问题”</a></p>
<p>相关配置如下</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">-- 建立<span class="module-access"><span class="module"><span class="identifier">LocalCA</span>.</span></span>cnf</span><br><span class="line">touch <span class="module-access"><span class="module"><span class="identifier">LocalCA</span>.</span></span>cnf</span><br><span class="line">内容如下：</span><br><span class="line"></span><br><span class="line"><span class="literal">[ <span class="identifier">req</span> ]</span></span><br><span class="line">distinguished_name  = req_distinguished_name</span><br><span class="line">x509_extensions     = root_ca</span><br><span class="line"></span><br><span class="line"><span class="literal">[ <span class="identifier">req_distinguished_name</span> ]</span></span><br><span class="line"></span><br><span class="line"># define CA</span><br><span class="line">countryName             = CN (<span class="number">2</span> letter code)</span><br><span class="line">countryName_min         = <span class="number">2</span></span><br><span class="line">countryName_max         = <span class="number">2</span></span><br><span class="line">stateOrProvinceName     = GuangDong</span><br><span class="line">localityName            = GuangZhou</span><br><span class="line"><span class="number">0.</span>organizationName      = LocalCompany</span><br><span class="line">organizationalUnitName  = technology</span><br><span class="line">commonName              = develop</span><br><span class="line">commonName_max          = <span class="number">64</span></span><br><span class="line">emailAddress            = local@email.com</span><br><span class="line">emailAddress_max        = <span class="number">64</span></span><br><span class="line"></span><br><span class="line"><span class="literal">[ <span class="identifier">root_ca</span> ]</span></span><br><span class="line">basicConstraints            = critical, CA:<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--建立<span class="module-access"><span class="module"><span class="identifier">LocalCA</span>.</span></span>ext</span><br><span class="line">touch <span class="module-access"><span class="module"><span class="identifier">LocalCA</span>.</span></span>ext</span><br><span class="line">内容如下：</span><br><span class="line"></span><br><span class="line">subjectAltName = @alt_names</span><br><span class="line">extendedKeyUsage = serverAuth</span><br><span class="line"></span><br><span class="line"><span class="literal">[<span class="identifier">alt_names</span>]</span></span><br><span class="line"></span><br><span class="line"># domain</span><br><span class="line">DNS.<span class="number">1</span> = domain.com</span><br><span class="line"># IP地址</span><br><span class="line">IP.<span class="number">1</span> = <span class="number">192.168</span>.<span class="number">2.221</span></span><br><span class="line">IP.<span class="number">2</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 生成证书命令</span><br><span class="line">-- CA证书，给设备使用</span><br><span class="line">openssl req -x509 -newkey rsa:<span class="number">2048</span> -out <span class="module-access"><span class="module"><span class="identifier">LocalCA4Device</span>.</span></span>cer -outform PEM -keyout <span class="module-access"><span class="module"><span class="identifier">LocalCA4Device</span>.</span></span>pvk -days <span class="number">10000</span> -verbose -config <span class="module-access"><span class="module"><span class="identifier">LocalCA</span>.</span></span>cnf -nodes -sha256 -subj <span class="string">"/CN=LocalCompany CA"</span></span><br><span class="line"></span><br><span class="line">-- 生成SSL证书</span><br><span class="line"></span><br><span class="line">openssl req -newkey rsa:<span class="number">2048</span> -keyout <span class="module-access"><span class="module"><span class="identifier">LocalCA4Nginx</span>.</span></span>pvk -out <span class="module-access"><span class="module"><span class="identifier">LocalCA4Nginx</span>.</span></span>req -subj /CN=localhost -sha256 -nodes</span><br><span class="line"></span><br><span class="line">openssl x509 -req -CA <span class="module-access"><span class="module"><span class="identifier">LocalCA4Device</span>.</span></span>cer -CAkey <span class="module-access"><span class="module"><span class="identifier">LocalCA4Device</span>.</span></span>pvk -<span class="keyword">in</span> <span class="module-access"><span class="module"><span class="identifier">LocalCA4Nginx</span>.</span></span>req -out <span class="module-access"><span class="module"><span class="identifier">LocalCA4Nginx</span>.</span></span>cer -days <span class="number">10000</span> -extfile <span class="module-access"><span class="module"><span class="identifier">LocalCA</span>.</span></span>ext -sha256 -set_serial <span class="number">0x1111</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>将 CA 证书安装到相关设备即可；Window 需安装到指定目录【受信任的根证书颁发机构】</p>
</blockquote>
<h3 id="OTA-下载的-html-内容"><a href="#OTA-下载的-html-内容" class="headerlink" title="OTA 下载的 html 内容"></a>OTA 下载的 html 内容</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>iOS-测试包下载<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span></span></span><br><span class="line"><span class="tag">      <span class="attr">name</span>=<span class="string">"viewport"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1,user-scalable=0"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"apple-mobile-web-app-capable"</span> <span class="attr">content</span>=<span class="string">"yes"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"apple-mobile-web-app-status-bar-style"</span> <span class="attr">content</span>=<span class="string">"black"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Cache-Control"</span> <span class="attr">content</span>=<span class="string">"no-siteapp"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Cache-Control"</span> <span class="attr">content</span>=<span class="string">"no-transform"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"format-detection"</span> <span class="attr">content</span>=<span class="string">"telephone=no"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag">        <span class="attr">href</span>=<span class="string">"itms-services://?action=download-manifest<span class="symbol">&amp;amp;</span>url=https://192.168.2.188/app/download/ios/manifest.plist"</span></span></span><br><span class="line"><span class="tag">        &gt;</span>点我安装<span class="tag">&lt;/<span class="name">a</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://192.168.2.188/app/download/ios/LocalCA4Device.cer"</span></span></span><br><span class="line"><span class="tag">        &gt;</span>下载证书<span class="tag">&lt;/<span class="name">a</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>常见问题<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span>问题：无法连接到 "xx.xx.xx.xx"<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">          解决：【设置 &gt; 通用 &gt; 关于本机 &gt; 证书信任设置】勾选信任</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span>问题：未受信任的企业级开发者<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">          解决：【设置 &gt; 通用 &gt; 描述文件与设备管理】添加到信任</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="nginx-配置"><a href="#nginx-配置" class="headerlink" title="nginx 配置"></a>nginx 配置</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">user</span>  nginx;</span><br><span class="line"><span class="attribute">worker_processes</span>  <span class="number">2</span>;</span><br><span class="line"><span class="attribute">pid</span>     /opt/nginx-<span class="number">1</span>.<span class="number">16</span>.<span class="number">1</span>/nginx.pid;</span><br><span class="line"><span class="attribute">error_log</span> /data/logs/nginx/error.log;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">   <span class="attribute">use</span> <span class="literal">epoll</span>;</span><br><span class="line">   <span class="attribute">worker_connections</span>  <span class="number">10240</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>             mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>        application/octet-stream;</span><br><span class="line">    <span class="attribute">log_format</span>          main    <span class="string">'<span class="variable">$remote_addr</span> <span class="variable">$request_length</span> <span class="variable">$request_time</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" <span class="variable">$status</span> <span class="variable">$bytes_sent</span> '</span></span><br><span class="line">                                <span class="string">'<span class="variable">$http_host</span> "<span class="variable">$proxy_add_x_forwarded_for</span>" "<span class="variable">$http_referer</span>" <span class="variable">$upstream_addr</span> <span class="variable">$upstream_response_time</span>'</span>;</span><br><span class="line">    <span class="attribute">access_log</span>                  /data/logs/nginx/access.log main;</span><br><span class="line">    <span class="attribute">server_tokens</span>               <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">gzip</span>                        <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_proxied</span>                any;</span><br><span class="line">    <span class="attribute">gzip_vary</span>                   <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_min_length</span>             <span class="number">100k</span>;</span><br><span class="line">    <span class="attribute">gzip_buffers</span>                <span class="number">4</span> <span class="number">16k</span>;</span><br><span class="line">    <span class="attribute">gzip_comp_level</span>             <span class="number">3</span>;</span><br><span class="line">    <span class="attribute">gzip_types</span>                  application/x-javascript text/plain application/xml text/xml application/xhtml+xml text/css text/javascript;</span><br><span class="line">    <span class="attribute">sendfile</span>                    <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">port_in_redirect</span>            <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>           <span class="number">60</span>;</span><br><span class="line">    <span class="attribute">keepalive_requests</span>          <span class="number">1000</span>;</span><br><span class="line">    <span class="attribute">log_not_found</span>               <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">client_max_body_size</span>        <span class="number">50M</span>;</span><br><span class="line">    <span class="attribute">client_header_buffer_size</span>   <span class="number">16k</span>;</span><br><span class="line">    <span class="attribute">large_client_header_buffers</span> <span class="number">8</span> <span class="number">32k</span>;</span><br><span class="line">    <span class="attribute">client_body_timeout</span>         <span class="number">300</span>;</span><br><span class="line">    <span class="attribute">client_body_buffer_size</span>     <span class="number">3072k</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">upstream</span> ota-server &#123;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.2.222:8080</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span> ;</span><br><span class="line">        <span class="attribute">server_name</span> <span class="number">192.168.2.188</span>;</span><br><span class="line">        <span class="attribute">root</span>       /home/nginx/html/;</span><br><span class="line">        <span class="attribute">error_page</span> <span class="number">404</span> <span class="number">502</span> = <span class="variable">@fetch</span>;</span><br><span class="line">        <span class="attribute">location</span>  <span class="variable">@fetch</span> &#123;</span><br><span class="line">                 <span class="attribute">default_type</span> application/json;</span><br><span class="line">                 <span class="attribute">return</span> <span class="number">200</span> <span class="string">'&#123;"result":500,"state":false,"msg":"server error"&#125;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~ /</span> &#123;</span><br><span class="line">                <span class="attribute">proxy_pass</span> http://ota-server;</span><br><span class="line">                <span class="attribute">proxy_read_timeout</span>      <span class="number">7200</span>;</span><br><span class="line">                <span class="attribute">proxy_connect_timeout</span>   <span class="number">5</span>;</span><br><span class="line">                <span class="attribute">proxy_set_header</span>        Host                <span class="variable">$Host</span>;</span><br><span class="line">                <span class="attribute">proxy_set_header</span>        X-Forwarded-For     <span class="variable">$remote_addr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">443</span> ;</span><br><span class="line">        <span class="attribute">server_name</span> <span class="number">192.168.2.188</span>;</span><br><span class="line">        <span class="attribute">ssl</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="attribute">ssl_certificate</span> /opt/nginx-<span class="number">1</span>.<span class="number">16</span>.<span class="number">1</span>/certs/LocalCA4Nginx.cer;</span><br><span class="line">        <span class="attribute">ssl_certificate_key</span> /opt/nginx-<span class="number">1</span>.<span class="number">16</span>.<span class="number">1</span>/certs/LocalCA4Nginx.pvk;</span><br><span class="line">        <span class="attribute">ssl_ciphers</span> HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">        <span class="attribute">root</span>    /home/nginx/html/;</span><br><span class="line">        <span class="attribute">error_page</span> <span class="number">404</span> <span class="number">502</span> = <span class="variable">@fetch</span>;</span><br><span class="line">        <span class="attribute">location</span>  <span class="variable">@fetch</span> &#123;</span><br><span class="line">                 <span class="attribute">default_type</span> application/json;</span><br><span class="line">                 <span class="attribute">return</span> <span class="number">200</span> <span class="string">'&#123;"result":500,"state":false,"msg":"server error"&#125;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> <span class="regexp">~ /</span> &#123;</span><br><span class="line">                <span class="attribute">proxy_pass</span> http://ota-server;</span><br><span class="line">                <span class="attribute">proxy_read_timeout</span>      <span class="number">7200</span>;</span><br><span class="line">                <span class="attribute">proxy_connect_timeout</span>   <span class="number">5</span>;</span><br><span class="line">                <span class="attribute">proxy_set_header</span>        Host                <span class="variable">$Host</span>;</span><br><span class="line">                <span class="attribute">proxy_set_header</span>        X-Forwarded-For     <span class="variable">$remote_addr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2019/05/21/代码片段-vue-自定义alert/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/05/21/代码片段-vue-自定义alert/" itemprop="url">
                  代码片段-vue-自定义alert
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-21T21:50:31+08:00">
                2019-05-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2019/05/07/learn-Object-C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/05/07/learn-Object-C/" itemprop="url">
                  learn Object C
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-07T22:36:58+08:00">
                2019-05-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote>
<p>初看Object-C的语法，确实让学Java的有多多少少感到头疼，最让人摸不着头脑到是它到语法，似乎怪怪的。</p>
</blockquote>
<p>该如何入门？从网上了解到《Objective-C基础教程 第2版》该书籍对入门有很大对帮助。</p>
<h2 id="一些能帮助我们理解Object-C的摘录"><a href="#一些能帮助我们理解Object-C的摘录" class="headerlink" title="一些能帮助我们理解Object-C的摘录"></a>一些能帮助我们理解Object-C的摘录</h2><h3 id="为何扩展名是-m"><a href="#为何扩展名是-m" class="headerlink" title="为何扩展名是.m?"></a>为何扩展名是.m?</h3><p>Object-C诞生之时，扩展名.m代表message；它是Object-C的一个重要特性。</p>
<h3 id="为何有很多NS前缀的类"><a href="#为何有很多NS前缀的类" class="headerlink" title="为何有很多NS前缀的类?"></a>为何有很多NS前缀的类?</h3><p>Cocoa给所有的函数、常量和类都加了NS前缀；主要是避免名称冲突。还可以追溯到Cocoa工具类都前身NextSTEP。</p>
<h3 id="为何NSLog的字符串前需要"><a href="#为何NSLog的字符串前需要" class="headerlink" title="为何NSLog的字符串前需要@"></a>为何NSLog的字符串前需要@</h3><p>@是Object-C在标准C语言基础上添加的特性之一。@符号意味着引号内的字符作为Cocoa的NSString来处理。</p>
<h3 id="id是什么？"><a href="#id是什么？" class="headerlink" title="id是什么？"></a>id是什么？</h3><p>id是一种泛型，可以用来引用任何类型的对象；实际上是一个指向结构体的指针。</p>
<h3 id="中括号的奇怪用法？"><a href="#中括号的奇怪用法？" class="headerlink" title="中括号的奇怪用法？"></a>中括号的奇怪用法？</h3><p>如 [car engineStart] 这个是Object-C有关中括号的一个用法：通知某个对象去做什么，也就是方法调用。在Object-C中，通知对象执行某种操作成为发送消息。</p>
<h3 id="interface"><a href="#interface" class="headerlink" title="@interface"></a>@interface</h3>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="seven-cm">
          <p class="site-author-name" itemprop="name">seven-cm</p>
           
              <p class="site-description motion-element" itemprop="description">少敲代码，多陪家人</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">80</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">100</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/seven-cm" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">seven-cm</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  








  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  







  





  

  

  

  

  

</body>
</html>
