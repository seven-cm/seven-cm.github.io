<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0">






<meta name="description" content="少敲代码，多陪家人">
<meta property="og:type" content="website">
<meta property="og:title" content="seven-cm.blog">
<meta property="og:url" content="http://seven-cm.github.io/page/5/index.html">
<meta property="og:site_name" content="seven-cm.blog">
<meta property="og:description" content="少敲代码，多陪家人">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="seven-cm.blog">
<meta name="twitter:description" content="少敲代码，多陪家人">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://seven-cm.github.io/page/5/">





  <title> seven-cm.blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?fea19912a68edcd8dd8884f7fc44c677";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">seven-cm.blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2017/08/18/Mysql-order-by-limit-效率问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/18/Mysql-order-by-limit-效率问题/" itemprop="url">
                  Mysql order by limit 效率问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-18T21:21:02+08:00">
                2017-08-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>今天业务在查询的时候，发现有些查询使用了相关的索引，还是很慢；特别是在相关数据量很少的时候，这个情况特别明显；有时候查询要10多秒，这种情况简直是无法忍受。</p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>在必应中搜索mysql order by limit 效率问题,会发现很多提到此类的问题。浏览到一篇对自己的问题比较有启发的文章：<a href="http://blog.itpub.net/22418990/viewspace-1467249/" target="_blank" rel="noopener">http://blog.itpub.net/22418990/viewspace-1467249/</a><br>里面有提到用explain来分析查询语句的效率；而且“分析一条慢SQL,要从多个角度去看，而不能只看已个方面，从上面的执行计划中，rows 很小，给人的感觉就是扫描的行数都这么少，怎么会慢呢。但是同时不能忘了 扫描方式为index这种耗时的操作。因此优化可以从这个角度去考虑。”让人有一种顿悟的感觉。</p>
<h2 id="详细分析"><a href="#详细分析" class="headerlink" title="详细分析"></a>详细分析</h2><p>我们来看看现在遇到的问题：<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain SELECT * FROM boss_shop_order  WHERE 1=1 AND shopId=10129 AND receiveTime &gt;= 1502985600 AND receiveTime &lt;= 1503072000 order by id desc  LIMIT 0, 20;</span><br><span class="line">+<span class="params">----</span>+<span class="params">-------------</span>+<span class="params">-----------------</span>+<span class="params">-------</span>+<span class="params">-----------------------------------</span>+<span class="params">---------</span>+<span class="params">---------</span>+<span class="params">------</span>+<span class="params">------</span>+<span class="params">-------------</span>+</span><br><span class="line">| id | select_type | table           | type  | possible_keys                     | key     | key_len | ref  | rows | Extra       |</span><br><span class="line">+<span class="params">----</span>+<span class="params">-------------</span>+<span class="params">-----------------</span>+<span class="params">-------</span>+<span class="params">-----------------------------------</span>+<span class="params">---------</span>+<span class="params">---------</span>+<span class="params">------</span>+<span class="params">------</span>+<span class="params">-------------</span>+</span><br><span class="line">|  1 | SIMPLE      | boss_shop_order | index | boss_shop_order_index_receiveTime | PRIMARY | 4       | NULL | 2699 | Using where |</span><br><span class="line">+<span class="params">----</span>+<span class="params">-------------</span>+<span class="params">-----------------</span>+<span class="params">-------</span>+<span class="params">-----------------------------------</span>+<span class="params">---------</span>+<span class="params">---------</span>+<span class="params">------</span>+<span class="params">------</span>+<span class="params">-------------</span>+</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM boss_shop_order  WHERE 1=1 AND shopId=10129 AND receiveTime &gt;= 1502985600 AND receiveTime &lt;= 1503072000 ORDER BY id DESC limit 0,20;</span><br><span class="line">+<span class="params">---------</span>+<span class="params">--------</span>+<span class="params">------------</span>+<span class="params">-------------------</span>+<span class="params">---------</span>+<span class="params">--------------------</span>+<span class="params">-------------</span>+<span class="params">-------</span>+<span class="params">----------</span>+<span class="params">----------</span>+<span class="params">--------</span>+<span class="params">--------</span>+<span class="params">-------------</span>+<span class="params">------------</span>+<span class="params">--------------------</span>+<span class="params">-------</span>+<span class="params">--------------------</span>+<span class="params">------------</span>+<span class="params">------------</span>+<span class="params">-------------</span>+<span class="params">----------</span>+<span class="params">--------------</span>+<span class="params">----------------</span>+<span class="params">-------</span>+<span class="params">--------------------------------------------------------------------------------</span>+<span class="params">--------------</span>+<span class="params">--------------</span>+<span class="params">-------------</span>+<span class="params">------</span>+<span class="params">------------</span>+<span class="params">-------------------------------------</span>+<span class="params">---------</span>+</span><br><span class="line">| id      | shopId | customerId | outTradeNo        | bizType | customerCategoryId | accountVal  | price | operator | province | city   | status | receiveTime | supplierId | supplierCategoryId | cost  | supplierOrderId    | submitTime | finishTime | chargeTimes | priority | manualStatus | callbackStatus | black | remark                                                                         | customerName | supplierName | productSize | area | failReason | systemTransNo                       | extInfo |</span><br><span class="line">+<span class="params">---------</span>+<span class="params">--------</span>+<span class="params">------------</span>+<span class="params">-------------------</span>+<span class="params">---------</span>+<span class="params">--------------------</span>+<span class="params">-------------</span>+<span class="params">-------</span>+<span class="params">----------</span>+<span class="params">----------</span>+<span class="params">--------</span>+<span class="params">--------</span>+<span class="params">-------------</span>+<span class="params">------------</span>+<span class="params">--------------------</span>+<span class="params">-------</span>+<span class="params">--------------------</span>+<span class="params">------------</span>+<span class="params">------------</span>+<span class="params">-------------</span>+<span class="params">----------</span>+<span class="params">--------------</span>+<span class="params">----------------</span>+<span class="params">-------</span>+<span class="params">--------------------------------------------------------------------------------</span>+<span class="params">--------------</span>+<span class="params">--------------</span>+<span class="params">-------------</span>+<span class="params">------</span>+<span class="params">------------</span>+<span class="params">-------------------------------------</span>+<span class="params">---------</span>+</span><br><span class="line">+<span class="params">---------</span>+<span class="params">--------</span>+<span class="params">------------</span>+<span class="params">-------------------</span>+<span class="params">---------</span>+<span class="params">--------------------</span>+<span class="params">-------------</span>+<span class="params">-------</span>+<span class="params">----------</span>+<span class="params">----------</span>+<span class="params">--------</span>+<span class="params">--------</span>+<span class="params">-------------</span>+<span class="params">------------</span>+<span class="params">--------------------</span>+<span class="params">-------</span>+<span class="params">--------------------</span>+<span class="params">------------</span>+<span class="params">------------</span>+<span class="params">-------------</span>+<span class="params">----------</span>+<span class="params">--------------</span>+<span class="params">----------------</span>+<span class="params">-------</span>+<span class="params">--------------------------------------------------------------------------------</span>+<span class="params">--------------</span>+<span class="params">--------------</span>+<span class="params">-------------</span>+<span class="params">------</span>+<span class="params">------------</span>+<span class="params">-------------------------------------</span>+<span class="params">---------</span>+</span><br><span class="line">4 rows in <span class="keyword">set</span> <span class="params">(10.39 sec)</span></span><br></pre></td></tr></table></figure></p>
<p>果然explain查询分析，只有几千条数据，怎么可能会慢呢？然后认真分析后，才发现，原来索引走的是主键，然而主键却在where条件却没有。那我们用receiveTime来作order by 是怎样的效果呢？</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain SELECT * FROM boss_shop_order  WHERE 1=1 AND shopId=10129 AND receiveTime &gt;= 1502985600 AND receiveTime &lt;= 1503072000 order by receiveTime desc  LIMIT 0, 20;</span><br><span class="line">+<span class="params">----</span>+<span class="params">-------------</span>+<span class="params">-----------------</span>+<span class="params">-------</span>+<span class="params">-----------------------------------</span>+<span class="params">-----------------------------------</span>+<span class="params">---------</span>+<span class="params">------</span>+<span class="params">-------</span>+<span class="params">-------------</span>+</span><br><span class="line">| id | select_type | table           | type  | possible_keys                     | key                               | key_len | ref  | rows  | Extra       |</span><br><span class="line">+<span class="params">----</span>+<span class="params">-------------</span>+<span class="params">-----------------</span>+<span class="params">-------</span>+<span class="params">-----------------------------------</span>+<span class="params">-----------------------------------</span>+<span class="params">---------</span>+<span class="params">------</span>+<span class="params">-------</span>+<span class="params">-------------</span>+</span><br><span class="line">|  1 | SIMPLE      | boss_shop_order | range | boss_shop_order_index_receiveTime | boss_shop_order_index_receiveTime | 5       | NULL | 39558 | Using where |</span><br><span class="line">+<span class="params">----</span>+<span class="params">-------------</span>+<span class="params">-----------------</span>+<span class="params">-------</span>+<span class="params">-----------------------------------</span>+<span class="params">-----------------------------------</span>+<span class="params">---------</span>+<span class="params">------</span>+<span class="params">-------</span>+<span class="params">-------------</span>+</span><br><span class="line">1 row in <span class="keyword">set</span> <span class="params">(0.00 sec)</span></span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM boss_shop_order  WHERE 1=1 AND shopId=10129 AND receiveTime &gt;= 1502985600 AND receiveTime &lt;= 1503072000 order by receiveTime desc  LIMIT 0, 20;</span><br><span class="line">+<span class="params">---------</span>+<span class="params">--------</span>+<span class="params">------------</span>+<span class="params">-------------------</span>+<span class="params">---------</span>+<span class="params">--------------------</span>+<span class="params">-------------</span>+<span class="params">-------</span>+<span class="params">----------</span>+<span class="params">----------</span>+<span class="params">--------</span>+<span class="params">--------</span>+<span class="params">-------------</span>+<span class="params">------------</span>+<span class="params">--------------------</span>+<span class="params">-------</span>+<span class="params">--------------------</span>+<span class="params">------------</span>+<span class="params">------------</span>+<span class="params">-------------</span>+<span class="params">----------</span>+<span class="params">--------------</span>+<span class="params">----------------</span>+<span class="params">-------</span>+<span class="params">--------------------------------------------------------------------------------</span>+<span class="params">--------------</span>+<span class="params">--------------</span>+<span class="params">-------------</span>+<span class="params">------</span>+<span class="params">------------</span>+<span class="params">-------------------------------------</span>+<span class="params">---------</span>+</span><br><span class="line">| id      | shopId | customerId | outTradeNo        | bizType | customerCategoryId | accountVal  | price | operator | province | city   | status | receiveTime | supplierId | supplierCategoryId | cost  | supplierOrderId    | submitTime | finishTime | chargeTimes | priority | manualStatus | callbackStatus | black | remark                                                                         | customerName | supplierName | productSize | area | failReason | systemTransNo                       | extInfo |</span><br><span class="line">+<span class="params">---------</span>+<span class="params">--------</span>+<span class="params">------------</span>+<span class="params">-------------------</span>+<span class="params">---------</span>+<span class="params">--------------------</span>+<span class="params">-------------</span>+<span class="params">-------</span>+<span class="params">----------</span>+<span class="params">----------</span>+<span class="params">--------</span>+<span class="params">--------</span>+<span class="params">-------------</span>+<span class="params">------------</span>+<span class="params">--------------------</span>+<span class="params">-------</span>+<span class="params">--------------------</span>+<span class="params">------------</span>+<span class="params">------------</span>+<span class="params">-------------</span>+<span class="params">----------</span>+<span class="params">--------------</span>+<span class="params">----------------</span>+<span class="params">-------</span>+<span class="params">--------------------------------------------------------------------------------</span>+<span class="params">--------------</span>+<span class="params">--------------</span>+<span class="params">-------------</span>+<span class="params">------</span>+<span class="params">------------</span>+<span class="params">-------------------------------------</span>+<span class="params">---------</span>+</span><br><span class="line">+<span class="params">---------</span>+<span class="params">--------</span>+<span class="params">------------</span>+<span class="params">-------------------</span>+<span class="params">---------</span>+<span class="params">--------------------</span>+<span class="params">-------------</span>+<span class="params">-------</span>+<span class="params">----------</span>+<span class="params">----------</span>+<span class="params">--------</span>+<span class="params">--------</span>+<span class="params">-------------</span>+<span class="params">------------</span>+<span class="params">--------------------</span>+<span class="params">-------</span>+<span class="params">--------------------</span>+<span class="params">------------</span>+<span class="params">------------</span>+<span class="params">-------------</span>+<span class="params">----------</span>+<span class="params">--------------</span>+<span class="params">----------------</span>+<span class="params">-------</span>+<span class="params">--------------------------------------------------------------------------------</span>+<span class="params">--------------</span>+<span class="params">--------------</span>+<span class="params">-------------</span>+<span class="params">------</span>+<span class="params">------------</span>+<span class="params">-------------------------------------</span>+<span class="params">---------</span>+</span><br><span class="line">4 rows in <span class="keyword">set</span> <span class="params">(0.06 sec)</span></span><br></pre></td></tr></table></figure>
<p>到此，慢查询应该是暂时没有了。我们再看explain中的key已经变为了boss_shop_order_index_receiveTime，与ｗhere中的条件的receiveTime一致，所以走了相关的索引而不会全表扫描。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>还是那句：分析一条慢SQL,要从多个角度去看，而不能只简单看explain中的rows；从上面的执行计划中，rows很小，给人的感觉就是扫描的行数都这么少，怎么会慢呢。但是你会在慢查询日志中会发现，实际情况却是走了全表扫描。因此要实际情况实际分析，多角度考虑，而不是仅仅看explain中的rows就觉得不可能会产生慢查询。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2017/08/04/使用squid搭建http代理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/04/使用squid搭建http代理/" itemprop="url">
                  使用squid搭建http代理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-04T21:44:32+08:00">
                2017-08-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>之前了解到使用littleProxy可以作http代理。故很多项目都是使用该jar包来作为http代理。但是这样比较不方便，故准备使用spuid来搭建http代理。</p>
<h2 id="squid是什么？"><a href="#squid是什么？" class="headerlink" title="squid是什么？"></a>squid是什么？</h2><p>Squid是一个高性能的代理缓存服务器，Squid支持FTP、gopher和HTTP协议。和一般的代理缓存软件不同，Squid用一个单独的、非模块化的、I/O驱动的进程来处理所有的客户端请求。</p>
<p>wiki:<br>Squid is a caching and forwarding HTTP web proxy. It has a wide variety of uses, including speeding up a web server by caching repeated requests, caching web, DNS and other computer network lookups for a group of people sharing network resources, and aiding security by filtering traffic. Although primarily used for HTTP and FTP, Squid includes limited support for several other protocols including Internet Gopher, SSL,[6] TLS and HTTPS. Squid does not support the SOCKS protocol.</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> squid</span><br></pre></td></tr></table></figure>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Recommended minimum configuration:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">acl manager proto cache_object</span><br><span class="line">acl localhost src 127.0.0.1/32 ::1</span><br><span class="line">acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example rule allowing access from your local networks.</span></span><br><span class="line"><span class="comment"># Adapt to list your (internal) IP networks from where browsing</span></span><br><span class="line"><span class="comment"># should be allowed</span></span><br><span class="line">acl localnet src 10.0.0.0/8     # RFC1918 possible internal network</span><br><span class="line">acl localnet src 172.16.0.0/12  # RFC1918 possible internal network</span><br><span class="line">acl localnet src 192.168.0.0/16 # RFC1918 possible internal network</span><br><span class="line">acl localnet src fc00::/7       # RFC 4193 local private<span class="built_in"> network </span>range</span><br><span class="line">acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines</span><br><span class="line"></span><br><span class="line">acl SSL_ports<span class="built_in"> port </span>443</span><br><span class="line">acl Safe_ports<span class="built_in"> port </span>80          # http</span><br><span class="line">acl Safe_ports<span class="built_in"> port </span>21          # ftp</span><br><span class="line">acl Safe_ports<span class="built_in"> port </span>443         # https</span><br><span class="line">acl Safe_ports<span class="built_in"> port </span>70          # gopher</span><br><span class="line">acl Safe_ports<span class="built_in"> port </span>210         # wais</span><br><span class="line">acl Safe_ports<span class="built_in"> port </span>1025-65535  # unregistered ports</span><br><span class="line">acl Safe_ports<span class="built_in"> port </span>280         # http-mgmt</span><br><span class="line">acl Safe_ports<span class="built_in"> port </span>488         # gss-http</span><br><span class="line">acl Safe_ports<span class="built_in"> port </span>591         # filemaker</span><br><span class="line">acl Safe_ports<span class="built_in"> port </span>777         # multiling http</span><br><span class="line">acl CONNECT method CONNECT</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Recommended minimum Access Permission configuration:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Only allow cachemgr access from localhost</span></span><br><span class="line">http_access allow manager localhost</span><br><span class="line">http_access deny manager</span><br><span class="line"></span><br><span class="line"><span class="comment"># Deny requests to certain unsafe ports</span></span><br><span class="line">http_access deny !Safe_ports</span><br><span class="line"></span><br><span class="line"><span class="comment"># Deny CONNECT to other than secure SSL ports</span></span><br><span class="line">http_access deny CONNECT !SSL_ports</span><br><span class="line"></span><br><span class="line"><span class="comment"># We strongly recommend the following be uncommented to protect innocent</span></span><br><span class="line"><span class="comment"># web applications running on the proxy server who think the only</span></span><br><span class="line"><span class="comment"># one who can access services on "localhost" is a local user</span></span><br><span class="line"><span class="comment">#http_access deny to_localhost</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Example rule allowing access from your local networks.</span></span><br><span class="line"><span class="comment"># Adapt localnet in the ACL section to list your (internal) IP networks</span></span><br><span class="line"><span class="comment"># from where browsing should be allowed</span></span><br><span class="line"><span class="comment">#http_access allow localnet</span></span><br><span class="line"><span class="comment">#http_access allow localhost</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># And finally deny all other access to this proxy</span></span><br><span class="line"><span class="comment">#http_access deny all</span></span><br><span class="line"></span><br><span class="line">dns_nameservers 8.8.8.8</span><br><span class="line"></span><br><span class="line">http_access allow all</span><br><span class="line">visible_hostname t</span><br><span class="line"></span><br><span class="line"><span class="comment"># Squid normally listens to port 3128</span></span><br><span class="line">http_port 3128</span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment and adjust the following to add a disk cache directory.</span></span><br><span class="line"><span class="comment">#cache_dir ufs /var/spool/squid 100 16 256</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Leave coredumps in the first cache dir</span></span><br><span class="line">coredump_dir /var/spool/squid</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add any of your own refresh_pattern entries above these.</span></span><br><span class="line">refresh_pattern ^ftp:           1440    20%     10080</span><br><span class="line">refresh_pattern ^gopher:        1440    0%      1440</span><br><span class="line">refresh_pattern -i (/cgi-bin/|\?) 0     0%      0</span><br><span class="line">refresh_pattern .               0       20%     4320</span><br></pre></td></tr></table></figure>
<h2 id="相关命令"><a href="#相关命令" class="headerlink" title="相关命令"></a>相关命令</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#检查配置是否正确</span></span><br><span class="line"><span class="string">./squid</span> -k parse</span><br><span class="line"><span class="comment">#启动</span></span><br><span class="line"><span class="string">./squid</span></span><br><span class="line"><span class="comment">#停止</span></span><br><span class="line"><span class="string">./squid</span> -k <span class="keyword">shutdown</span></span><br></pre></td></tr></table></figure>
<h2 id="发现问题"><a href="#发现问题" class="headerlink" title="发现问题"></a>发现问题</h2><p>按上述的配置，你修改后，你会发现通过java代理请求的时候，服务端获取到的ip并不是代理服务器的ip,而是代理客户端的ip。那该问题如何解决？</p>
<h2 id="添加配置信息"><a href="#添加配置信息" class="headerlink" title="添加配置信息"></a>添加配置信息</h2><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">request_header_access Via deny <span class="keyword">all</span></span><br><span class="line">request_header_access X-Forwarded-<span class="keyword">For</span> deny <span class="keyword">all</span></span><br></pre></td></tr></table></figure>
<p>添加上述配置后，即可隐藏由客户端带出去的头部信息。而通过配置后的方式后，java通过代理的请求在服务端中获取到的ip为代理服务器的ip。</p>
<h2 id="最后要注意的地方"><a href="#最后要注意的地方" class="headerlink" title="最后要注意的地方"></a>最后要注意的地方</h2><p>因代理配置中是http_access allow all，也就是所有ip都可以请求。如果要在生产环境中配置，则需在防火墙中增加可请求ip；以保证生产环境的安全.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2017/07/25/Java-wsdl设置http代理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/25/Java-wsdl设置http代理/" itemprop="url">
                  Java wsdl设置http代理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-25T22:22:04+08:00">
                2017-07-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>因业务需要，有时候在用Java调用wsdl服务的时候，需要使用http代理。但是通过搜索，很多都是使用<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">System.getProperties().put(<span class="string">"proxySet"</span>, <span class="string">"true"</span>);</span><br><span class="line">System.getProperties().put(<span class="string">"https.proxyHost"</span>, HTTPS_PROXY_HOST);  </span><br><span class="line">System.getProperties().put(<span class="string">"https.proxyPort"</span>, HTTPS_PROXY_PORT);</span><br></pre></td></tr></table></figure></p>
<p>全局设置来实现http代理。有没有更好的方法？</p>
<h2 id="使用Apache-CXF"><a href="#使用Apache-CXF" class="headerlink" title="使用Ａpache-CXF"></a>使用Ａpache-CXF</h2><p>直接使用HTTPClientPolicy来实现http代理。主要实现代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">JaxWsProxyFactoryBean factoryBean = <span class="keyword">new</span> JaxWsProxyFactoryBean();  </span><br><span class="line">factoryBean.setServiceClass(webservice-<span class="class"><span class="keyword">interface</span>.<span class="title">clazz</span>)</span>;  </span><br><span class="line">factoryBean.setAddress(<span class="string">"webservice-address-此处不一定是'http://xxx?wsdl的地址',而是提供服务的service地址"</span>);  </span><br><span class="line">webservice-<span class="class"><span class="keyword">interface</span> <span class="title">portType</span> </span>= (webservice-<span class="class"><span class="keyword">interface</span> )<span class="title">factoryBean</span>.<span class="title">create</span>()</span>;  </span><br><span class="line"></span><br><span class="line">Client client = ClientProxy.getClient(portType);</span><br><span class="line">HTTPConduit http = (HTTPConduit) client.getConduit();</span><br><span class="line">HTTPClientPolicy hcp = <span class="keyword">new</span> HTTPClientPolicy();</span><br><span class="line">hcp.setProxyServer(proxyHost);</span><br><span class="line">hcp.setProxyServerPort(proxyport);</span><br><span class="line">http.setClient(hcp);</span><br></pre></td></tr></table></figure></p>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>在使apache-cxf的时候，需要检查系统中是否已经包含了*-wsdl4j的jar包；注意版本的问题，否则会报No Such Method的错误.</p>
<p>另外，如果直接new xxx(‘<a href="http://xxxx?wsdl&#39;)；注意该地址一定是要包含webservice的合法xml；否则cxf也会报错。" target="_blank" rel="noopener">http://xxxx?wsdl&#39;)；注意该地址一定是要包含webservice的合法xml；否则cxf也会报错。</a></p>
<p>参考文章: [cxf设置代理访问webservice接口-Gin.p][1]<br>[1]: <a href="http://www.cnblogs.com/ginponson/p/5259383.html" target="_blank" rel="noopener">http://www.cnblogs.com/ginponson/p/5259383.html</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2017/07/18/记生产环境因Nginx重启造成代理死循环/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/18/记生产环境因Nginx重启造成代理死循环/" itemprop="url">
                  记生产环境因Nginx重启造成代理死循环
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-18T23:56:30+08:00">
                2017-07-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在项目初期，都是使用域名作为server_name来配置的。然而随着项目的服务不断增加，有些API必须指定IP+端口来；为了方便，就直接用了tomcat的端。而这样一来，就引出了单该tomcat的服务需要更新的时候，服务会被中断的问题。</p>
<h2 id="前期方案"><a href="#前期方案" class="headerlink" title="前期方案"></a>前期方案</h2><p>为了解决服务不会被中断的问题；使用了Nginx的热备功能:<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream my_server&#123;</span><br><span class="line"> <span class="built_in"> server </span>127.0.0.1:8084;</span><br><span class="line"> <span class="built_in"> server </span>127.0.0.1:8085 backup;        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这样就会在8084服务重启的时候,所有请求到my_server的服务会指向8085的tomcat。</p>
<p>然后了解到server_name也是IP地址;那么解决方法就很简单了，使用Nginx直接监听之前tomcat的端口，同时变更tomcat的端口。</p>
<h2 id="没有想到的代理死循环"><a href="#没有想到的代理死循环" class="headerlink" title="没有想到的代理死循环"></a>没有想到的代理死循环</h2><p>想想，配置改一下，reload后应该就OK了。<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream my_server&#123;</span><br><span class="line"> <span class="built_in"> server </span>127.0.0.1:8084;</span><br><span class="line"> <span class="built_in"> server </span>127.0.0.1:8085 backup;        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上述的配置变更为<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">upstream my_server&#123;</span><br><span class="line">  # server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8084</span>;</span><br><span class="line">  server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8085</span> backup;        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">8084</span>;</span><br><span class="line">    server_name  <span class="number">192.168</span><span class="number">.1</span><span class="number">.3</span>;</span><br><span class="line">    ... ...</span><br><span class="line">    location / &#123;</span><br><span class="line">      proxy_pass http:<span class="comment">//my_server;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然而，在Nginx -s reload后,8084端口访问不了了。通过查看Nginx的进程，发现进程比之前多了一倍(系统配置的8个process;查看发现有16个process)</p>
<h2 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h2><p>首先要了解nginx -s reload 的命令会触发什么动作:<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">为了让主进程重新读取配置文件，应该向主进程发送一个HUP信号，主进程一旦接收到重新加载配置的的信号，它就检查配置文件语法的有效性，然后试图应用新的配置，即打开新的日志文件和新的<span class="built_in">socket</span> 监听，如果失败，它将回滚配置更改并继续使用旧的配置，如果成功了，它开启新的工作进程，并给旧的工作进程发消息让它们优雅的关闭，旧的工作进程接收到关闭信号后，不再接收新的请求，如果已有请求正在处理，等当前请求处理完毕后关闭，如果没有请求正在处理，则直接关闭。</span><br></pre></td></tr></table></figure></p>
<p>但是上述的配置在于老的进程有代理到8084的端口，而新的进程则在监听8084端口，这样一来，就陷入了死循环了。</p>
<h2 id="最终解决方案"><a href="#最终解决方案" class="headerlink" title="最终解决方案"></a>最终解决方案</h2><p>1、先在upstream中去掉8084端口的代理，然后reload。<br>2、把server listen 8084的配置加上；然后再reload。<br>3、最后再把新的tomcat端口加上到upstream中去。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2017/06/23/Java-comparator-报空指针异常/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/23/Java-comparator-报空指针异常/" itemprop="url">
                  Java comparator 报空指针异常
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-23T23:12:24+08:00">
                2017-06-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近在生产库上总是会发现某个实现了接口Comparator的类排序总是会报空指针异常。</p>
<h1 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h1><p>为了重现…..</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2017/06/23/Jekins-Maven-module-拉取bug/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/23/Jekins-Maven-module-拉取bug/" itemprop="url">
                  Jekins Maven module 拉取bug
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-23T23:06:21+08:00">
                2017-06-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近使用maven分模块开发，但是在使用jekins集成发布的时候，每次拉取是拉取当天jekins中没有的jar。当天后续更新，然后提交到私仓库后的就再也没有拉取了。</p>
<h1 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h1><p>为了方便解决这个问题，只能写shell每次编译前，都先把jekins中的maven下载的相关的module jar给删除。</p>
<p>后续如果有更好的办法再更新说明一下。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2017/06/10/webmagic-phantomjs爬取天猫数据/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/10/webmagic-phantomjs爬取天猫数据/" itemprop="url">
                  webmagic+phantomjs爬取天猫数据
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-10T00:37:56+08:00">
                2017-06-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>天猫的一些数据是由前端渲染而来；直接用http请求会拿不到相关数据。故使用webmagic+phantomjs来获取。</p>
<h2 id="webmagic"><a href="#webmagic" class="headerlink" title="webmagic"></a>webmagic</h2><p>有关webmagic的介绍，访问：<a href="http://webmagic.io/" target="_blank" rel="noopener">http://webmagic.io/</a> 即可</p>
<h2 id="phantomjs"><a href="#phantomjs" class="headerlink" title="phantomjs"></a>phantomjs</h2><p>PhantomJS is a headless WebKit scriptable with a JavaScript API.</p>
<p>一个完整的浏览器内核,包括js解析引擎,渲染引擎,请求处理等,但是不包括显示和用户交互页面的浏览器</p>
<h2 id="集成开发"><a href="#集成开发" class="headerlink" title="集成开发"></a>集成开发</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = Logger.getLogger(HuabanProcessor<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">	<span class="comment">//设置cookies</span></span><br><span class="line">	String cookieValue=<span class="string">"xxx"</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Site site = Site.me().addHeader(<span class="string">"cookie"</span>, cookieValue).setRetryTimes(<span class="number">3</span>).setSleepTime(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(Page page)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//打印页面信息 </span></span><br><span class="line">		<span class="comment">//log.info(page.getHtml().get());</span></span><br><span class="line">		<span class="comment">//获取列表所有商品详情链接</span></span><br><span class="line">		List&lt;String&gt; detailUrls = page.getHtml().$(<span class="string">".productImg-wrap a"</span>).links().all();</span><br><span class="line">		<span class="comment">//商品标题</span></span><br><span class="line">		List&lt;String&gt; detailTitle = page.getHtml().$(<span class="string">".productTitle a"</span>).xpath(<span class="string">"//a/text()"</span>).all();</span><br><span class="line">		<span class="comment">//商品价格</span></span><br><span class="line">		List&lt;String&gt; detailPrice = page.getHtml().$(<span class="string">".productPrice"</span>).xpath(<span class="string">"//em/text()"</span>).all();</span><br><span class="line">		List&lt;TmallProduct&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>,len=detailUrls.size();i&lt;len;i++)&#123;</span><br><span class="line">			TmallProduct tmallProduct = <span class="keyword">new</span> TmallProduct(detailUrls.get(i), </span><br><span class="line">					detailTitle.get(i), detailPrice.get(i));</span><br><span class="line">			list.add(tmallProduct);</span><br><span class="line">		&#125;</span><br><span class="line">		page.putField(<span class="string">"detail"</span>, list);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Spider.create(<span class="keyword">new</span> HuabanProcessor())</span><br><span class="line">		<span class="comment">//天猫地址</span></span><br><span class="line">		.addUrl(<span class="string">"天猫商品搜索地址"</span>).thread(<span class="number">5</span>)</span><br><span class="line">		<span class="comment">//下载到文件</span></span><br><span class="line">		.addPipeline(<span class="keyword">new</span> JsonFilePipeline(<span class="string">"/home/sevencm/下载/tmall-detail-url"</span>))</span><br><span class="line">		<span class="comment">//使用phantomjs</span></span><br><span class="line">		.downloader(<span class="keyword">new</span> SeleniumDownloader())</span><br><span class="line">		.run();</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Site <span class="title">getSite</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> site;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h2 id="结果输出信息"><a href="#结果输出信息" class="headerlink" title="结果输出信息"></a>结果输出信息</h2><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"detail"</span>:[&#123;<span class="attr">"price"</span>:<span class="string">"5588.00"</span>,<span class="attr">"title"</span>:<span class="string">" 【5588限量抢】Apple/   128G 全网通4G智能手机正品 "</span>,<span class="attr">"url"</span>:<span class="string">"https://detail.tmall.com/item.htm?id=538207238901&amp;skuId=3216546719688&amp;user_id=2616970884&amp;cat_id=2&amp;is_b=1&amp;rn=b9d270f8286c3097bb07716a5393c5f0"</span>&#125;,&#123;<span class="attr">"price"</span>:<span class="string">"6398.00"</span>,<span class="attr">"title"</span>:<span class="string">" 【6398疯抢】Apple/   Plus 128G 全网通4G智能手机 "</span>,<span class="attr">"url"</span>:<span class="string">"https://detail.tmall.com/item.htm?id=539336903257&amp;skuId=3419763583741&amp;user_id=2616970884&amp;cat_id=2&amp;is_b=1&amp;rn=b9d270f8286c3097bb07716a5393c5f0"</span>&#125;,</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2017/06/07/vue2-0基础之ES6语法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/07/vue2-0基础之ES6语法/" itemprop="url">
                  vue2.0基础之ES6语法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-07T23:41:45+08:00">
                2017-06-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>有关module还是直接看大神的著作中的介绍吧：<br>ECMAScript 6 入门 - ECMAScript 6入门　阮一峰<br><a href="http://es6.ruanyifeng.com/#docs/module" target="_blank" rel="noopener">http://es6.ruanyifeng.com/#docs/module</a></p>
<h1 id="摘录"><a href="#摘录" class="headerlink" title="摘录"></a>摘录</h1><p>【以下部分，全部摘录于阮一峰的《ECMAScript 6 入门》】</p>
<h2 id="模块的构成"><a href="#模块的构成" class="headerlink" title="模块的构成"></a>模块的构成</h2><p>模块功能主要由两个命令构成：export和import。</p>
<h2 id="export"><a href="#export" class="headerlink" title="export"></a>export</h2><p>export命令用于规定模块的对外接口，import命令用于输入其他模块提供的功能。</p>
<p>一个模块就是一个独立的文件。该文件内部的所有变量，外部无法获取。如果你希望外部能够读取模块内部的某个变量，就必须使用export关键字输出该变量。</p>
<p>需要特别注意的是，export命令规定的是对外的接口，必须与模块内部的变量建立一一对应关系。</p>
<h2 id="import"><a href="#import" class="headerlink" title="import"></a>import</h2><p>使用export命令定义了模块的对外接口以后，其他 JS 文件就可以通过import命令加载这个模块。</p>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; stat, <span class="keyword">exists</span>, readFile &#125; from <span class="string">'fs'</span>;</span><br></pre></td></tr></table></figure>
<p>上面代码的实质是从fs模块加载3个方法，其他方法不加载。这种加载称为“编译时加载”或者静态加载，即 ES6 可以在编译时就完成模块加载，效率要比 CommonJS 模块的加载方式高</p>
<h2 id="export-default"><a href="#export-default" class="headerlink" title="export default"></a>export default</h2><p>从前面的例子可以看出，使用import命令的时候，用户需要知道所要加载的变量名或函数名，否则无法加载。但是，用户肯定希望快速上手，未必愿意阅读文档，去了解模块有哪些属性和方法。</p>
<p>为了给用户提供方便，让他们不用阅读文档就能加载模块，就要用到export default命令，为模块指定默认输出。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2017/06/05/Maven-java-spring-多环境配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/05/Maven-java-spring-多环境配置/" itemprop="url">
                  Maven-java-spring-多环境配置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-05T23:52:43+08:00">
                2017-06-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>在pom文件中加入以下属性配置<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 开发环境，默认激活 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span>&gt;</span>development<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- Spring XML profile 环境标识 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">profiles.active</span>&gt;</span>development<span class="tag">&lt;/<span class="name">profiles.active</span>&gt;</span></span><br><span class="line">                 <span class="comment">&lt;!-- log4j测试环境配置文件名 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">log4j.file.name</span>&gt;</span>log4j_t<span class="tag">&lt;/<span class="name">log4j.file.name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 默认启用的是dev环境配置 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 部署环境 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">id</span>&gt;</span>production<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">             <span class="comment">&lt;!-- Spring XML profile 环境标识 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">profiles.active</span>&gt;</span>production<span class="tag">&lt;/<span class="name">profiles.active</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- log4j生产环境配置文件名 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">log4j.file.name</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">log4j.file.name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 生产环境默认关闭 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>false<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>在上述配置后，如果需要打包不同的环境，则使用clean install -P development/production命令即可</p>
<ol start="2">
<li><p>配置上述属性，需增加maven 插件配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-war-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">					<span class="comment">&lt;!-- 激活spring profile --&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">webResources</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/webapp<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;<span class="name">include</span>&gt;</span>**/web.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">webResources</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">warSourceDirectory</span>&gt;</span>src/main/webapp<span class="tag">&lt;/<span class="name">warSourceDirectory</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">webXml</span>&gt;</span>src/main/webapp/WEB-INF/web.xml<span class="tag">&lt;/<span class="name">webXml</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在web.xml中使用Spring的配置，指定加载相关的配置文件信息</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>log4jConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>/WEB-INF/config/log4j/$&#123;log4j.file.name&#125;.properties<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.util.Log4jConfigListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 公共配置XML --&gt;</span></span><br><span class="line">			/WEB-INF/config/spring/common_Context.xml</span><br><span class="line">			/WEB-INF/config/spring/shiro_Context.xml</span><br><span class="line">			/WEB-INF/config/spring/scheduleJob_Context.xml</span><br><span class="line">   		<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- spring 中使用哪种开发配置 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>spring.profiles.active<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>$&#123;profiles.active&#125;<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>在上述文件，我们可以看到引用pom属性的值，只需使用${properties}即可</p>
<ol start="4">
<li>Spring中如何配置开发环境与生产环境？<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">context:property-placeholder</span></span></span><br><span class="line"><span class="tag">			<span class="attr">location</span>=<span class="string">"/WEB-INF/config/properties/db/setting_t.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">bean</span>  <span class="attr">id</span>=<span class="string">"messageSource"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">class</span>=<span class="string">"org.springframework.context.support.ReloadableResourceBundleMessageSource"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basenames"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">value</span>&gt;</span>/WEB-INF/config/properties/db/setting_t<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">value</span>&gt;</span>/WEB-INF/config/properties/yangcong/yangcong<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">value</span>&gt;</span>/WEB-INF/config/properties/wx/wx<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cacheSeconds"</span> <span class="attr">value</span>=<span class="string">"36000"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">"production"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">context:property-placeholder</span></span></span><br><span class="line"><span class="tag">			<span class="attr">location</span>=<span class="string">"/WEB-INF/config/properties/db/setting.properties"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">bean</span>  <span class="attr">id</span>=<span class="string">"messageSource"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">class</span>=<span class="string">"org.springframework.context.support.ReloadableResourceBundleMessageSource"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basenames"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">value</span>&gt;</span>/WEB-INF/config/properties/db/setting<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">value</span>&gt;</span>/WEB-INF/config/properties/yangcong/yangcong<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">value</span>&gt;</span>/WEB-INF/config/properties/wx/wx<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cacheSeconds"</span> <span class="attr">value</span>=<span class="string">"36000"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	需要注意的是beans 后面不允许存在"<span class="tag">&lt;<span class="name">bean</span>&gt;</span>"级信息。</span><br></pre></td></tr></table></figure>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://seven-cm.github.io/2017/05/25/vue2-0基础入门之认识vue指令-二/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="seven-cm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="seven-cm.blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/25/vue2-0基础入门之认识vue指令-二/" itemprop="url">
                  vue2.0基础入门之认识vue指令(二)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-25T22:59:13+08:00">
                2017-05-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="vue指令"><a href="#vue指令" class="headerlink" title="vue指令"></a>vue指令</h1><h2 id="v-text-指令"><a href="#v-text-指令" class="headerlink" title="v-text 指令"></a>v-text 指令</h2><p>更新元素的 textContent<br><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">v-text</span>=<span class="string">"msg"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 和下面的一样 --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span><span class="template-variable">&#123;&#123;msg&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<h2 id="v-html-指令"><a href="#v-html-指令" class="headerlink" title="v-html　指令"></a>v-html　指令</h2><p>更新元素的 innerHTML 。注意：内容按普通 HTML 插入 - 不会作为 Vue 模板进行编译 。如果试图使用 v-html 组合模板,可以重新考虑是否通过使用组件来替代。<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">div</span> v-html=<span class="string">"html"</span>&gt;&lt;/<span class="keyword">div</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>[注意]在网站上动态渲染任意 HTML 是非常危险的，因为容易导致 XSS 攻击。只在可信内容上使用 v-html，永不用在用户提交的内容上。</p>
<h2 id="v-bind-指令"><a href="#v-bind-指令" class="headerlink" title="v-bind 指令"></a>v-bind 指令</h2><p>动态地绑定一个或多个特性，或一个组件 prop 到表达式。</p>
<p>在绑定 class 或 style 特性时，支持其它类型的值，如数组或对象。可以通过下面的教程链接查看详情。</p>
<p>在绑定 prop 时，prop 必须在子组件中声明。可以用修饰符指定不同的绑定类型。</p>
<p>没有参数时，可以绑定到一个包含键值对的对象。注意此时 class 和 style 绑定不支持数组和对象。</p>
<h2 id="v-once-指令"><a href="#v-once-指令" class="headerlink" title="v-once 指令"></a>v-once 指令</h2><p>只渲染元素和组件一次。随后的重新渲染,元素/组件及其所有的子节点将被视为静态内容并跳过。这可以用于优化更新性能。</p>
<p>另外还有v-pre指令以及v-cloak指令</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="seven-cm">
          <p class="site-author-name" itemprop="name">seven-cm</p>
           
              <p class="site-description motion-element" itemprop="description">少敲代码，多陪家人</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">80</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">100</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/seven-cm" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">seven-cm</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  








  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  







  





  

  

  

  

  

</body>
</html>
